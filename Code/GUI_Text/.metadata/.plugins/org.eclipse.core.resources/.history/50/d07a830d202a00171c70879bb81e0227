package net.kerfuffle.textTest;

import org.lwjgl.*;
import org.lwjgl.glfw.*;
import org.lwjgl.opengl.*;
import org.lwjgl.system.*;

import net.kerfuffle.Utilities.GUI.Button;
import net.kerfuffle.Utilities.GUI.Camera2D;
import net.kerfuffle.Utilities.GUI.Color;
import net.kerfuffle.Utilities.GUI.DavisGUI;
import net.kerfuffle.Utilities.GUI.DavisImage;
import net.kerfuffle.Utilities.GUI.KeyPressListener;
import net.kerfuffle.Utilities.GUI.OnClickListener;
import net.kerfuffle.Utilities.GUI.Player;
import net.kerfuffle.Utilities.GUI.Polygon;
import net.kerfuffle.Utilities.GUI.Quad;
import net.kerfuffle.Utilities.GUI.RGB;
import net.kerfuffle.Utilities.GUI.Triangle;

import java.io.IOException;
import java.nio.*;

import static org.lwjgl.glfw.Callbacks.*;
import static org.lwjgl.glfw.GLFW.*;
import static org.lwjgl.opengl.GL11.*;
import static org.lwjgl.system.MemoryStack.*;
import static org.lwjgl.system.MemoryUtil.*;

import static org.lwjgl.glfw.GLFW.*;
import static org.lwjgl.stb.STBEasyFont.*;
import static org.lwjgl.opengl.GL15.*;

public class HelloWorld extends DavisGUI{

	public static final int WIDTH = 1000, HEIGHT = 700;

	private Player p;
	private Button leftArrow, rightArrow;

	public HelloWorld()
	{
		super("Hey", WIDTH, HEIGHT);
	}

	public static void main(String args[]) throws IOException
	{
		new HelloWorld().run();
	}

	public void	childInit()
	{
		p = new Player(new Quad(0-25, 0-25, 50, 50, new RGB(0,1,0)), GLFW_KEY_W, GLFW_KEY_S, GLFW_KEY_A, GLFW_KEY_D, true);
		p.setZoomKeys(GLFW_KEY_O, GLFW_KEY_P);
		p.setZoomSpeed(1.01f);
		p.setTexture("res/A.png");


		Triangle leftTri = new Triangle(-400, -300, new RGB(1,0,1));
		leftTri.setRelativeVertex(0, 0, 0);
		leftTri.setRelativeVertex(1, 0, 100);
		leftTri.setRelativeVertex(2, -50, 50);

		leftArrow = new Button(leftTri);
		leftArrow.setOnClickListener(new OnClickListener()
		{
			public void onClick() 
			{
				System.out.println("left triggered");
			}
		});
		leftArrow.setKeyPressListener(new KeyPressListener(GLFW.GLFW_KEY_LEFT){
			public void onPress()
			{
				leftArrow.setColor(new RGB((float)Math.random(), (float)Math.random(), (float)Math.random()));
			}
		});

		Triangle rightTri = new Triangle(400, -300, new RGB(1,0,1));
		rightTri.setRelativeVertex(0, 0, 0);
		rightTri.setRelativeVertex(1, 0, 100);
		rightTri.setRelativeVertex(2, 50, 50);

		rightArrow = new Button(rightTri);
		rightArrow.setOnClickListener(new OnClickListener()
		{
			public void onClick() 
			{
				System.out.println("right triggered");
			}
		});
		rightArrow.setKeyPressListener(new KeyPressListener(GLFW.GLFW_KEY_RIGHT){
			public void onPress()
			{
				rightArrow.setColor(new RGB((float)Math.random(), (float)Math.random(), (float)Math.random()));
			}
		});

	}

	public void childLoop() 
	{

		String scoreText = "S";
		float scoreTextX = 0;
		float scoreTextY = 0;
		renderer.drawText(scoreText, scoreTextX, scoreTextY, Color.WHITE);

		int vertices = 3;

		int vertex_size = 3; // X, Y, Z,
		int color_size = 3; // R, G, B,

		FloatBuffer vertex_data = BufferUtils.createFloatBuffer(vertices * vertex_size);
		vertex_data.put(new float[] { -100f, -100f, 0f, });
		vertex_data.put(new float[] { 100f, -100f, 0f, });
		vertex_data.put(new float[] { 100f, 100f, 0f, });
		vertex_data.flip();

		FloatBuffer color_data = BufferUtils.createFloatBuffer(vertices * color_size);
		color_data.put(new float[] { 100f, 100f, 0f, });
		color_data.put(new float[] { 100f, 100f, 0f, });
		color_data.put(new float[] { 100f, 100f, 0f, });
		color_data.flip();

		int vbo_vertex_handle = glGenBuffers();
		glBindBuffer(GL_ARRAY_BUFFER, vbo_vertex_handle);
		glBufferData(GL_ARRAY_BUFFER, vertex_data, GL_STATIC_DRAW);
		glBindBuffer(GL_ARRAY_BUFFER, 0);

		int vbo_color_handle = glGenBuffers();
		glBindBuffer(GL_ARRAY_BUFFER, vbo_color_handle);
		glBufferData(GL_ARRAY_BUFFER, color_data, GL_STATIC_DRAW);
		glBindBuffer(GL_ARRAY_BUFFER, 0);
		
		glBindBuffer(GL_ARRAY_BUFFER, vbo_vertex_handle);
		glVertexPointer(vertex_size, GL_FLOAT, 0, 0l);

		glBindBuffer(GL_ARRAY_BUFFER, vbo_color_handle);
		glColorPointer(color_size, GL_FLOAT, 0, 0l);

		glEnableClientState(GL_VERTEX_ARRAY);
		glEnableClientState(GL_COLOR_ARRAY);

		glDrawArrays(GL_TRIANGLES, 0, vertices);

		glDisableClientState(GL_COLOR_ARRAY);
		glDisableClientState(GL_VERTEX_ARRAY);




		leftArrow.update();
		rightArrow.update();

		p.update();
	}


}